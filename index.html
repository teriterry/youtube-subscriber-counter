<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>YouTube ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²è€…æ•°</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <style>
    body {
      background-color: transparent;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    #subscriberCount {
      font-size: 3em;
      margin-top: 20px;
    }

    #loginBtn {
      padding: 12px 24px;
      font-size: 1em;
      background-color: #cc0000;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="loginBtn">Google ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ç™»éŒ²è€…æ•°ã‚’è¡¨ç¤º</button>
  <div id="subscriberCount">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    const CLIENT_ID = '447703056009-5u9n18137gdlknbd5ds1rhr4h6rt4ifs.apps.googleusercontent.com';
    const REDIRECT_URI = window.location.href.split('#')[0];

    function getAccessTokenFromUrl() {
      const hashParams = new URLSearchParams(window.location.hash.substr(1));
      return hashParams.get('access_token');
    }

    async function getSubscriberCount(token) {
      console.log("ğŸ“¡ Fetching subscriber count...");
      try {
        const response = await fetch('https://www.googleapis.com/youtube/v3/channels?part=statistics&mine=true', {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        const data = await response.json();
        console.log("ğŸ“¦ API response:", data);

        if (!response.ok || !data.items || data.items.length === 0) {
          $('#subscriberCount').text('ç™»éŒ²è€…æ•°ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
          return;
        }

        const count = data.items[0].statistics.subscriberCount;
        $('#subscriberCount').text(`ç™»éŒ²è€…æ•°ï¼š${count}`);
      } catch (err) {
        console.error(err);
        $('#subscriberCount').text('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    }

    $(document).ready(function () {
      const token = getAccessTokenFromUrl();
      console.log("ğŸ”‘ Access token:", token);

      if (token) {
        $('#loginBtn').hide();
        getSubscriberCount(token);
        setInterval(() => getSubscriberCount(token), 30000);
      }

      $('#loginBtn').on('click', function () {
        const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
          `client_id=${CLIENT_ID}&` +
          `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
          `response_type=token&` +
          `scope=https://www.googleapis.com/auth/youtube.readonly&` +
          `include_granted_scopes=true`;

        window.location.href = authUrl;
      });
    });
  </script>
</body>
</html>
