<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>YouTube チャンネル登録者数</title>
  <style>
    body {
      background-color: transparent;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    #subscriberCount {
      font-size: 3em;
      margin-top: 20px;
    }

    #loginBtn {
      padding: 12px 24px;
      font-size: 1em;
      background-color: #cc0000;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="loginBtn">Google にログインして登録者数を表示</button>
  <div id="subscriberCount">TEST</div>

  <script>
    const CLIENT_ID = '447703056009-5u9n18137gdlknbd5ds1rhr4h6rt4ifs.apps.googleusercontent.com'; // ← ここにあなたのクライアントIDを入力してください
    const REDIRECT_URI = window.location.href.split('#')[0];

    function getAccessTokenFromUrl() {
      const hashParams = new URLSearchParams(window.location.hash.substr(1));
      return hashParams.get('access_token');
    }

    async function getSubscriberCount(token) {
      const response = await fetch('https://www.googleapis.com/youtube/v3/channels?part=statistics&mine=true', {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });

      if (!response.ok) {
        document.getElementById("subscriberCount").textContent = '登録者数を取得できませんでした。再度ログインしてください。';
        return;
      }

      const data = await response.json();
      console.log(data);

      const count = data.items[0].statistics.subscriberCount;
      document.getElementById("subscriberCount").textContent = `登録者数：${count}`;
    }

    function startApp() {
      const token = getAccessTokenFromUrl();
      if (token) {
        document.getElementById("loginBtn").style.display = "none";
        getSubscriberCount(token);
        setInterval(() => getSubscriberCount(token), 30000);
      }
    }

    document.getElementById("loginBtn").addEventListener("click", () => {
      const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
        `client_id=${CLIENT_ID}&` +
        `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
        `response_type=token&` +
        `scope=https://www.googleapis.com/auth/youtube.readonly&` +
        `include_granted_scopes=true`;

      window.location.href = authUrl;
    });

    startApp();
  </script>
</body>
</html>
